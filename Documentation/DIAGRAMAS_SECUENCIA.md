# ðŸ”„ Diagramas de Secuencia - BitTorrent P2P

## Diagrama 1: ConexiÃ³n Inicial y Handshake

```
Cliente A                Tracker              Cliente B
   â”‚                        â”‚                     â”‚
   â”‚  GET /announce         â”‚                     â”‚
   â”‚  ?event=started        â”‚                     â”‚
   â”‚  &hostname=client1     â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
   â”‚                        â”‚                     â”‚
   â”‚  {"peers": [           â”‚                     â”‚
   â”‚    {"ip":"client2",    â”‚                     â”‚
   â”‚     "port":41801}]}    â”‚                     â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                        â”‚                     â”‚
   â”‚         TCP SYN (client2:41801)              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚          TCP SYN-ACKâ”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚         TCP ACK        â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚                     â”‚
   â”‚  Handshake Request     â”‚                     â”‚
   â”‚  [19|BitTorrent...     â”‚                     â”‚
   â”‚   |info_hash|peer_id]  â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚                     â”‚
   â”‚                        â”‚   Validar info_hash â”‚
   â”‚                        â”‚   Validar protocol  â”‚
   â”‚                        â”‚                     â”‚
   â”‚  Handshake Response    â”‚                     â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                     â”‚
   â”‚  Validar info_hash     â”‚                     â”‚
   â”‚                        â”‚                     â”‚
   â”‚  âœ… ConexiÃ³n OK        â”‚                     â”‚
   â”‚                        â”‚                     â”‚
```

---

## Diagrama 2: Intercambio de Bitfields y Descarga

```
Cliente A (Leecher)                      Cliente B (Seeder)
Has: [0,1,2]                             Has: [0,1,2,3,4,5,6,7]
Wants: [3,4,5,6,7]                       
   â”‚                                           â”‚
   â”‚  MsgBitfield [00001111]                  â”‚
   â”‚  (tengo piezas 0,1,2,3)                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                           â”‚
   â”‚                     MsgBitfield [11111111]â”‚
   â”‚                     (tengo todas)         â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                           â”‚
   â”‚  MsgInterested                            â”‚
   â”‚  (me interesan tus piezas)                â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                           â”‚
   â”‚                                Evaluar    â”‚
   â”‚                                choking    â”‚
   â”‚                                           â”‚
   â”‚                          MsgUnchoke       â”‚
   â”‚                          (puedes pedir)   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                           â”‚
   â”‚  Picker: NextPieceFor()                   â”‚
   â”‚  â†’ piece = 3 (primera que no tengo)       â”‚
   â”‚                                           â”‚
   â”‚  MsgRequest                               â”‚
   â”‚  [piece=3, begin=0, len=16384]            â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                           â”‚
   â”‚                          ReadBlock(3,0)   â”‚
   â”‚                          desde disco      â”‚
   â”‚                                           â”‚
   â”‚                     MsgPiece              â”‚
   â”‚                     [3][0][16KB data]     â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                           â”‚
   â”‚  WriteBlock(3, 0, data)                   â”‚
   â”‚  â†’ escribir a disco                       â”‚
   â”‚                                           â”‚
   â”‚  MsgRequest                               â”‚
   â”‚  [piece=3, begin=16384, len=16384]        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                           â”‚
   â”‚                     MsgPiece              â”‚
   â”‚                     [3][16384][16KB data] â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                           â”‚
   â”‚  ... (repetir hasta completar pieza)      â”‚
   â”‚                                           â”‚
   â”‚  WriteBlock(3, N, last_data)              â”‚
   â”‚  â†’ Pieza 3 completa                       â”‚
   â”‚  â†’ Verificar SHA-1 âœ…                     â”‚
   â”‚  â†’ Marcar bitfield[3] = 1                 â”‚
   â”‚                                           â”‚
```

---

## Diagrama 3: Broadcast HAVE a MÃºltiples Peers

```
Cliente A                  Cliente B         Cliente C         Cliente D
bitfield: [111]            [110]             [100]             [101]
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚  Completa pieza 3        â”‚                 â”‚                 â”‚
   â”‚  SHA-1 OK âœ…             â”‚                 â”‚                 â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚  MsgHave(3)              â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚                          â”‚  Actualizar     â”‚  Actualizar     â”‚
   â”‚                          â”‚  remoteBF[A]    â”‚  remoteBF[A]    â”‚
   â”‚                          â”‚  bit 3 = 1      â”‚  bit 3 = 1      â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚                          â”‚  Evaluar:       â”‚  Evaluar:       â”‚
   â”‚                          â”‚  Â¿Necesito 3?   â”‚  Â¿Necesito 3?   â”‚
   â”‚                          â”‚  â†’ SÃ­           â”‚  â†’ SÃ­           â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚         MsgInterested    â”‚                 â”‚                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                 â”‚
   â”‚                          â”‚  MsgInterested  â”‚                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚  MsgUnchoke              â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                 â”‚
   â”‚  MsgUnchoke              â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚         MsgRequest       â”‚  MsgRequest     â”‚                 â”‚
   â”‚         [3][0][16KB]     â”‚  [3][0][16KB]   â”‚                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
   â”‚                          â”‚                 â”‚                 â”‚
   â”‚  MsgPiece [3][0][...]    â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                 â”‚
   â”‚  MsgPiece [3][0][...]    â”‚                 â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
   â”‚                          â”‚                 â”‚                 â”‚
```

---

## Diagrama 4: Ciclo Completo con Tracker

```
Cliente                 Tracker                 Storage (Disco)
   â”‚                       â”‚                          â”‚
   â”‚  1. Announce          â”‚                          â”‚
   â”‚  event=started        â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  peers list           â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  2. Conectar a peers  â”‚                          â”‚
   â”‚  (handshake)          â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  3. Intercambio       â”‚                          â”‚
   â”‚  de bitfields         â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  4. Request bloques   â”‚                          â”‚
   â”‚  (MsgRequest)         â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  5. Recibir bloques   â”‚                          â”‚
   â”‚  (MsgPiece)           â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚                       â”‚   WriteBlock(piece, offset, data)
   â”‚                       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                       â”‚   â”‚  f.Seek(offset)       â”‚
   â”‚                       â”‚   â”‚  f.Write(data)        â”‚
   â”‚                       â”‚   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                          â”‚
   â”‚  6. Pieza completa    â”‚                          â”‚
   â”‚                       â”‚   ReadPiece(piece)       â”‚
   â”‚                       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                       â”‚   â”‚  leer del disco       â”‚
   â”‚                       â”‚   â”‚  sha1.Sum(data)       â”‚
   â”‚                       â”‚   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚   SHA-1 Match âœ…         â”‚
   â”‚                       â”‚                          â”‚
   â”‚  7. Broadcast HAVE    â”‚                          â”‚
   â”‚  a todos los peers    â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  ... (repetir 4-7)    â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  8. Todas completas   â”‚                          â”‚
   â”‚                       â”‚   Rename .part â†’ final   â”‚
   â”‚                       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                       â”‚   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                          â”‚
   â”‚  9. Announce          â”‚                          â”‚
   â”‚  event=completed      â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                       â”‚  Update stats            â”‚
   â”‚                       â”‚  (complete++)            â”‚
   â”‚                       â”‚                          â”‚
   â”‚  10. Periodic         â”‚                          â”‚
   â”‚  announces cada 30min â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                       â”‚                          â”‚
   â”‚  11. Shutdown         â”‚                          â”‚
   â”‚  event=stopped        â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                       â”‚  RemovePeer()            â”‚
   â”‚                       â”‚                          â”‚
```

---

## Diagrama 5: Estado del Peer (State Machine)

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   INITIAL STATE     â”‚
                  â”‚  Choking=true       â”‚
                  â”‚  Interested=false   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Handshake OK
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  CONNECTED          â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Recibir Bitfield
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  HAVE REMOTE        â”‚
                  â”‚  BITFIELD           â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Evaluar interÃ©s
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”Œâ”€â”€â”€â”€â”€>â”‚  INTERESTED         â”‚
           â”‚      â”‚  (AmInterested=true)â”‚
           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚ Recibir Unchoke
           â”‚                 â–¼
           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      â”‚  CAN DOWNLOAD       â”‚
           â”‚      â”‚  (PeerChoking=false)â”‚
           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚ Picker: NextPieceFor()
           â”‚                 â–¼
           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      â”‚  DOWNLOADING        â”‚
           â”‚      â”‚  (curPiece set)     â”‚
           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚ Loop: Requestâ†’Piece
           â”‚                 â”‚ WriteBlock()
           â”‚                 â”‚
           â”‚                 â”‚ Pieza completa
           â”‚                 â–¼
           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      â”‚  PIECE COMPLETE     â”‚
           â”‚      â”‚  Broadcast HAVE     â”‚
           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚ MÃ¡s piezas?
           â”‚                 â”œâ”€â”€â”€ SÃ­ â”€â”€â”€â”€â”
           â”‚                 â”‚           â”‚
           â”‚                 No          â”‚
           â”‚                 â”‚           â”‚
           â”‚                 â–¼           â–¼
           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      â”‚  ALL COMPLETE       â”‚
           â”‚      â”‚  SendNotInterested  â”‚
           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚      Si peer envÃ­a HAVE de pieza
           â”‚      que necesitamos, volver a
           â””â”€â”€â”€â”€â”€â”€INTERESTED

```

---

## Diagrama 6: Pipeline de Requests (Futuro)

```
Actual (Pipeline = 1):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
  Request[0]  â†’  Wait  â†’  Piece[0]  â†’  Request[1]  â†’  Wait ...
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€
      RTT          RTT        RTT          RTT


Optimizado (Pipeline = 5):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
  Req[0]  Req[1]  Req[2]  Req[3]  Req[4]
  â”€â”€â”€â”€â”€â”  â”€â”€â”€â”€â”€â”  â”€â”€â”€â”€â”€â”  â”€â”€â”€â”€â”€â”  â”€â”€â”€â”€â”€â”
       â”‚       â”‚       â”‚       â”‚       â”‚
    Piece[0] Piece[1] Piece[2] ...
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         RTT (una sola vez)
         
Ventaja: 5x menos latencia total
```

---

## Diagrama 7: Docker Swarm DNS Resolution

```
Cliente A (client1)         Docker Swarm          Cliente B (client2)
Container IP: 10.0.1.8      DNS Service           Container IP: 10.0.1.9
   â”‚                             â”‚                        â”‚
   â”‚  Announce                   â”‚                        â”‚
   â”‚  hostname=client1           â”‚                        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚                             â”‚  Store:                â”‚
   â”‚                             â”‚  client1â†’10.0.1.8      â”‚
   â”‚                             â”‚                        â”‚
   â”‚                             â”‚  Announce              â”‚
   â”‚                             â”‚  hostname=client2      â”‚
   â”‚                             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                             â”‚  Store:                â”‚
   â”‚                             â”‚  client2â†’10.0.1.9      â”‚
   â”‚                             â”‚                        â”‚
   â”‚  GET /announce              â”‚                        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚                             â”‚  Return:               â”‚
   â”‚  {"peers": [                â”‚  [{"ip":"client2",     â”‚
   â”‚    {"ip":"client2",         â”‚     "port":41801}]     â”‚
   â”‚     "port":41801}]}         â”‚                        â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
   â”‚                             â”‚                        â”‚
   â”‚  Conectar a "client2:41801" â”‚                        â”‚
   â”‚  DNS lookup: client2        â”‚                        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚                             â”‚  Resolver:             â”‚
   â”‚                             â”‚  client2 â†’ 10.0.1.9    â”‚
   â”‚  Resolved: 10.0.1.9:41801   â”‚                        â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
   â”‚                             â”‚                        â”‚
   â”‚  TCP connect to 10.0.1.9:41801                       â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                             â”‚                        â”‚
   â”‚                      Handshake + Transfer            â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                             â”‚                        â”‚
```

---

## Resumen de Protocolos

### HTTP (Tracker Communication)
```
GET /announce?info_hash=XXX&peer_id=YYY&port=6881&hostname=client1&event=started
â†’ Response: bencode{interval, peers: [{ip, port}]}

GET /scrape?info_hash=XXX
â†’ Response: bencode{files: {hash: {complete, incomplete, downloaded}}}
```

### TCP (Peer Wire Protocol)
```
1. Handshake: [19|"BitTorrent protocol"|8null|info_hash|peer_id]
2. Messages: [length:4B][id:1B][payload:NB]
   - Choke/Unchoke (control de flujo)
   - Interested/NotInterested (declaraciÃ³n de interÃ©s)
   - Have (notificaciÃ³n de nueva pieza)
   - Bitfield (estado inicial)
   - Request (solicitud de bloque)
   - Piece (envÃ­o de bloque)
```

### Bencode (Serialization)
```
Integers:  i42e
Strings:   4:spam
Lists:     l4:spam4:eggse
Dicts:     d3:cow3:moo4:spam4:eggse
```

---

